# Interactive component

**Proportion of patients in terms of Length of Stay and number of previous visits in this hospital**  
Chose the number of previous admissions thanks to the button below.
<html lang="en">
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v7.js"></script>

<!-- Initialize a select button -->
<select id="selectButton"></select>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<script>

// set the dimensions and margins of the graph
const margin = {top: 10, right: 100, bottom: 50, left: 30},
    width = 800 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
    

// append the svg object to the body of the page
const svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",`translate(${margin.left}, ${margin.top})`);

//Read the data
d3.csv("https://raw.githubusercontent.com/Raphaeladda/LengthOfStay/main/initial/data_interactive.csv").then(function(data){

    // List of groups (here I have one group per column)
    const allGroup = ["zero","one","two","three","four","five_or_more"]

    // add the options to the button
    d3.select("#selectButton")
      .selectAll('myOptions')
     	.data(allGroup)
      .enter()
    	.append('option')
      .text(function (d) { return d; }) // text showed in the menu
      .attr("value", function (d) { return d; }) // corresponding value returned by the button

    // Add X axis --> it is a date format
    const x = d3.scaleLinear()
      .domain([1,9])
      .range([ 0, width ]);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

    // Add Y axis
    const y = d3.scaleLinear()
      .domain( [0,100])
      .range([ height, 0 ])

    svg.append("g")
      .call(d3.axisLeft(y));

    // Initialize line with group a
    const line = svg
      .append('g')
      .append("path")
        .datum(data)
        .attr("d", d3.line()
          .x(function(d) { return x(+d.LoS) })
          .y(function(d) { return y(+d.zero) })
        )
        .attr("stroke", "black")
        .style("stroke-width", 4)
        .style("fill", "none")

    // Initialize dots with group a
    const dot = svg
      .selectAll('circle')
      .data(data)
      .enter()
      .append('circle')
        .attr("cx", function(d) { return x(+d.LoS) })
        .attr("cy", function(d) { return y(+d.zero) })
        .attr("r", 7)
        .style("fill", "#69b3a2")
      
    // Add the text label for the x axis
    svg.append("text")
      .attr("transform", "translate(" + (width + margin.left) + " ," + (height + 0.7*margin.bottom) + ")")
      .style("text-anchor", "middle")
      .text("Length Of Stay");

    // Add the text label for the y axis
    svg.append("text")
      .attr("transform", "translate(" + (3*margin.left) + " ," + (margin.top) + ")")
      .style("text-anchor", "middle")
      .text("Percentage of patients");


    // A function that update the chart
    function update(selectedGroup) {

      // Create new data with the selection?
      const dataFilter = data.map(function(d){return {LoS: d.LoS, value:d[selectedGroup]} })

      // Give these new data to update line
      line
          .datum(dataFilter)
          .transition()
          .duration(1000)
          .attr("d", d3.line()
            .x(function(d) { return x(+d.LoS) })
            .y(function(d) { return y(+d.value) })
          )
      dot
        .data(dataFilter)
        .transition()
        .duration(1000)
          .attr("cx", function(d) { return x(+d.LoS) })
          .attr("cy", function(d) { return y(+d.value) })
    }

    // When the button is changed, run the updateChart function
    d3.select("#selectButton").on("change", function(d) {
        // recover the option that has been chosen
        const selectedOption = d3.select(this).property("value")
        // run the updateChart function with this selected option
        update(selectedOption)
    })


})


</script>
</html>

This interactive connected scatterplot shows interesting patterns between the length of stay of a patient and the number of previous admissions. Indeed, we notice that the length of stay of a patient in the hospital considerably increases when his number of previous admissions is high.  
The surface under the curve becomes higher at the right of the graph when we select high values of previous admissions: this graph perfectly illustrates the effect of the number of previous admissions on the length of stay.  
Thus we can conclude that the number of previous admissions is a useful indicator to estimate the length of stay of a patient in the hospital.
